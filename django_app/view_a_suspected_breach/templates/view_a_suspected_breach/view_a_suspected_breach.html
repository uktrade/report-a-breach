{% extends "report_a_suspected_breach/base_form_step.html" %}
{% load crispy_forms_tags crispy_forms_gds %}
{% load get_end_user_url %}
{% block form_content %}
    <div>
        <h1 class="govuk-heading-l">
            Suspected breach report
        </h1>
    </div>
    <h2 class="govuk-heading-m">Reporter</h2>
    <dl class="govuk-summary-list">
        <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key govuk-!-font-weight-regular">
                Full name
            </dt>
            <dd class="govuk-summary-list__value">
                {{ breach.reporter_full_name }}
            </dd>
        </div>

        <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key govuk-!-font-weight-regular">
                Business reporter works for
            </dt>
            {% if breach.reporter_name_of_business_you_work_for %}
                <dd class="govuk-summary-list__value">
                    {{ breach.reporter_name_of_business_you_work_for }}
                </dd>
            {% elif companies_house_company %}
                <dd class="govuk-summary-list__value">
                    {{ companies_house_company.registered_company_name }}

                </dd>
            {% else %}
                <dd class="govuk-summary-list__value">
                    {{ breacher.name }}
                </dd>
            {% endif %}
        </div>

    </dl>
    <h2 class="govuk-heading-m">Person or business suspected of breaching sanctions</h2>
    <dl class="govuk-summary-list">
        {% if companies_house_company %}
            <div class="govuk-summary-list__row">
                <dt class="govuk-summary-list__key govuk-!-font-weight-regular">
                    Registered business number
                </dt>
                <dd class="govuk-summary-list__value">
                    {{ companies_house_company.registered_company_number }}
                </dd>
            </div>
            <div class="govuk-summary-list__row">
                <dt class="govuk-summary-list__key govuk-!-font-weight-regular">
                    Name
                </dt>
                <dd class="govuk-summary-list__value">
                    {{ companies_house_company.registered_company_name }}
                </dd>
            </div>
            <div class="govuk-summary-list__row">
                <dt class="govuk-summary-list__key govuk-!-font-weight-regular">
                    Address
                </dt>
                <dd class="govuk-summary-list__value">
                    {{ companies_house_company.registered_office_address | linebreaksbr }}
                </dd>
            </div>
        {% else %}
            <div class="govuk-summary-list__row">
                <dt class="govuk-summary-list__key govuk-!-font-weight-regular">
                    Name
                </dt>
                <dd class="govuk-summary-list__value">
                    {{ breacher.name }}
                </dd>
            </div>
            <div class="govuk-summary-list__row">
                <dt class="govuk-summary-list__key govuk-!-font-weight-regular">
                    Website
                </dt>
                <dd class="govuk-summary-list__value">
                    {% if breacher.website %}
                        <a class="govuk-link"
                           href="{{ form_data.about_the_supplier.website }}">{{ breacher.website }}<span
                            class="govuk-visually-hidden">{# todo - hidden copy #}</span></a>
                    {% endif %}
                </dd>
            </div>
            <div class="govuk-summary-list__row">
                <dt class="govuk-summary-list__key govuk-!-font-weight-regular">
                    Address
                </dt>
                <dd class="govuk-summary-list__value">
                    {{ breacher_address | linebreaksbr }}
                </dd>
            </div>
        {% endif %}
    </dl>
    <h2 class="govuk-heading-m">Overview of the breach</h2>
    <dl class="govuk-summary-list">
        <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key govuk-!-font-weight-regular">
                When did you first suspect the breach?
            </dt>
            <dd class="govuk-summary-list__value">
                {{ breach.is_the_date_accurate | title}} date <br>
                {{ breach.when_did_you_first_suspect }}
            </dd>
        </div>
        <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key govuk-!-font-weight-regular">
                Sanctions regimes breached
            </dt>
            <dd class="govuk-summary-list__value">
                {% for regime in sanctions %}
                    {{ regime.full_name }}
                    <br>
                {% endfor %}
                {% if breach.unknown_sanctions_regime %}
                    Unknown regime<br>
                {% endif %}
                {% if breach.other_sanctions_regime %}
                    Other regime
                {% endif %}
            </dd>
        </div>
        <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key govuk-!-font-weight-regular">
                What was supplied or made available?
            </dt>
            <dd class="govuk-summary-list__value">
                {% include "report_a_suspected_breach/partials/truncated_text.html" with text=breach.what_were_the_goods|linebreaksbr %}
            </dd>
        </div>
    </dl>
    <h2 class="govuk-heading-m">The supply chain</h2>
    <h3 class="govuk-heading-s">Supplier</h3>
    <dl class="govuk-summary-list">
        <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key govuk-!-font-weight-regular">
                Location of supplier
            </dt>
            <dd class="govuk-summary-list__value">
                {{ supplier.country }}
            </dd>
        </div>
        <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key govuk-!-font-weight-regular">
                Name and address of supplier
            </dt>
            <dd class="govuk-summary-list__value">
                {{ supplier.name }}
                <br> <br>
                {{ supplier_address | linebreaksbr }}
            </dd>
        </div>
    </dl>
    {% if recipients %}
        {% for end_user in recipients %}
            <h3 class="govuk-heading-s">End-user {{ forloop.counter }}</h2>
            <dl class="govuk-summary-list">
                <div class="govuk-summary-list__row">
                    <dt class="govuk-summary-list__key govuk-!-font-weight-regular">
                        Location of end-user {{ forloop.counter }}
                    </dt>
                    <dd class="govuk-summary-list__value">
                        {{ end_user.country }}
                    </dd>
                </div>
                <div class="govuk-summary-list__row">
                    <dt class="govuk-summary-list__key govuk-!-font-weight-regular">
                        Name and address of end-user {{forloop.counter}}
                    </dt>
                    <dd class="govuk-summary-list__value">
                        {{ end_user.name }}<br><br>
                        {{end_user.name_of_business}}
                        <br><br>
                        {% include "report_a_suspected_breach/partials/truncated_text.html" with text=end_user.address|linebreaksbr %}
                    </dd>
                </div>
                <div class="govuk-summary-list__row">
                    <dt class="govuk-summary-list__key govuk-!-font-weight-regular">
                        Website
                    </dt>
                    <dd class="govuk-summary-list__value">
                        {% if end_user.website %}
                            <a class="govuk-link"
                               href="{{ end_user.website }}">{{ end_user.website }}<span
                                class="govuk-visually-hidden"></span></a>
                        {% endif %}
                    </dd>
                </div>
                <div class="govuk-summary-list__row">
                    <dt class="govuk-summary-list__key govuk-!-font-weight-regular">
                        Additional contact information
                    </dt>
                    <dd class="govuk-summary-list__value">
                        {% include "report_a_suspected_breach/partials/truncated_text.html" with text=end_user.additional_contact_details|linebreaksbr %}
                    </dd>
                </div>
            </dl>
        {% endfor %}
    {% endif %}
    </dl>
    {% if breach.were_there_other_addresses_in_the_supply_chain  == "yes" %}
        <h2 class="govuk-heading-m">Other addresses in the supply chain</h2>
        <dl class="govuk-summary-list">
            <div class="govuk-summary-list__row">
                <dt class="govuk-summary-list__key govuk-!-font-weight-regular">
                    Address
                </dt>
                <dd class="govuk-summary-list__value">
                    {% include "report_a_suspected_breach/partials/truncated_text.html" with text=breach.other_addresses_in_the_supply_chain|linebreaksbr %}
                </dd>
            </div>
        </dl>
    {% endif %}
    <h2 class="govuk-heading-m">Sanctions breach details</h2>
    <dl class="govuk-summary-list">
        <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key govuk-!-font-weight-regular">
                Upload supporting documents
            </dt>
            <dd class="govuk-summary-list__value">
                {% for document, url in documents.items %}

                    <a href="{{url}}" download>{{document}}</a><br>
                {% endfor %}

            </dd>
        </div>
        <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key govuk-!-font-weight-regular">
                Summary of the breach
            </dt>
            <dd class="govuk-summary-list__value">
                {% include "report_a_suspected_breach/partials/truncated_text.html" with text=breach.tell_us_about_the_suspected_breach|linebreaksbr %}
            </dd>
        </div>
    </dl>

{% endblock form_content %}


{% block extra_js %}
    {{ block.super }}
    <script type="text/javascript">
        $(document).ready(function () {
            $('body').on('click', '.read_more_button', function () {
                $(this).closest('.text_truncator').find('.truncated_text').addClass('hidden');
                $(this).closest('.text_truncator').find('.expanded_text').removeClass('hidden');
            });
            $('body').on('click', '.read_less_button', function () {
                $(this).closest('.text_truncator').find('.truncated_text').removeClass('hidden');
                $(this).closest('.text_truncator').find('.expanded_text').addClass('hidden');
            })


        })
    </script>
{% endblock extra_js %}
